<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Herramientas PDF gratuitas y seguras. Unir PDF, Dividir, PDF a Excel y m√°s. Sin subir archivos a la nube.">
    <title>iPDF Tools - Editor PDF Privado</title>
    
    <!-- FUENTES Y ICONOS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --brand-color: #e5322d;
            --brand-hover: #c92b27;
            --dark: #33333b;
            --gray: #707078;
            --bg: #f5f5fa;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--dark);
            margin: 0; padding: 0;
            display: flex; flex-direction: column; min-height: 100vh;
        }

        /* --- HEADER --- */
        header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 0 5%;
            height: 70px;
            display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 100;
        }
        .logo { 
            font-size: 24px; font-weight: 800; color: var(--brand-color); 
            cursor: pointer; display: flex; align-items: center; gap: 10px; 
        }
        .nav-links { display: flex; gap: 20px; font-weight: 600; font-size: 14px; display: none; }
        @media (min-width: 768px) { .nav-links { display: flex; } }

        /* --- MEN√ö PRINCIPAL --- */
        .hero { text-align: center; padding: 60px 20px 40px; }
        .hero h1 { font-size: 36px; margin-bottom: 10px; color: var(--dark); letter-spacing: -1px; }
        .hero p { font-size: 18px; color: var(--gray); font-weight: 400; max-width: 600px; margin: 0 auto; }

        .container { max-width: 1200px; margin: 0 auto 60px; padding: 0 20px; }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
            gap: 20px; 
        }

        .card {
            background: white; padding: 30px; border-radius: 12px;
            text-align: center; transition: all 0.3s ease; cursor: pointer;
            border: 1px solid transparent; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%;
        }
        .card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: #e5e5e5; }
        
        .card-icon { font-size: 42px; color: var(--brand-color); margin-bottom: 15px; }
        .card h3 { font-size: 18px; margin: 10px 0; font-weight: 700; }
        .card p { font-size: 14px; color: var(--gray); line-height: 1.5; margin: 0; }

        /* --- ZONA DE HERRAMIENTA (CORREGIDO) --- */
        .tool-interface {
            display: none; /* Oculto por defecto */
            background: #fff;
            min-height: 100vh;
            padding: 40px 20px;
            text-align: center;
            animation: fadeIn 0.3s ease;
        }

        /* Esta es la clase que arregla tu problema visual */
        .upload-zone {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #f7f9fa;
            border: 3px dashed #e0e0e0;
            width: 90%;
            max-width: 650px;
            min-height: 350px; /* Altura m√≠nima asegurada */
            margin: 40px auto;
            padding: 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-zone:hover { border-color: var(--brand-color); background: #fffcfc; }
        .upload-zone i { font-size: 80px; color: var(--brand-color); margin-bottom: 25px; }
        .upload-zone span { font-size: 22px; font-weight: 600; color: var(--dark); }

        .big-btn {
            background: var(--brand-color); color: white;
            border: none; padding: 18px 40px; border-radius: 8px;
            font-size: 20px; font-weight: 700; cursor: pointer;
            margin-top: 30px; transition: 0.2s; width: 100%; max-width: 350px;
            box-shadow: 0 4px 10px rgba(229, 50, 45, 0.2);
        }
        .big-btn:hover { background: var(--brand-hover); transform: scale(1.02); }
        .big-btn:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }

        .back-link { 
            margin-top: 50px; display: inline-block; color: #666; 
            text-decoration: none; font-weight: 600; cursor: pointer;
        }
        .back-link:hover { color: var(--brand-color); }

        /* Inputs extra (borrar paginas) */
        #extra-options { margin: 20px auto; max-width: 300px; }
        .input-box { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; text-align: center; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>

    <!-- LIBRER√çAS CDN (Vitales) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7/download.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>

    <!-- CABECERA -->
    <header>
        <div class="logo" onclick="location.reload()">
            <i class="fa-solid fa-file-pdf"></i>&nbsp; iPDF Tools
        </div>
        <div class="nav-links">
            <span>Unir PDF</span>
            <span>Dividir PDF</span>
            <span>Comprimir</span>
        </div>
    </header>

    <!-- VISTA PRINCIPAL (GRID) -->
    <div id="main-menu">
        <div class="hero">
            <h1>Herramientas PDF gratuitas y privadas</h1>
            <p>Todo ocurre en tu navegador. Tus archivos nunca salen de tu ordenador.</p>
        </div>

        <div class="container grid">
            <div class="card" onclick="openTool('merge')">
                <i class="card-icon fa-solid fa-code-merge"></i>
                <h3>Unir PDF</h3>
                <p>Combina m√∫ltiples archivos en uno solo ordenado.</p>
            </div>

            <div class="card" onclick="openTool('split')">
                <i class="card-icon fa-solid fa-scissors"></i>
                <h3>Dividir PDF</h3>
                <p>Separa un archivo en p√°ginas individuales.</p>
            </div>

            <div class="card" onclick="openTool('excel')">
                <i class="card-icon fa-solid fa-file-excel"></i>
                <h3>PDF a Excel</h3>
                <p>Extrae tablas y listas a formato .xlsx editable.</p>
            </div>

            <div class="card" onclick="openTool('rotate')">
                <i class="card-icon fa-solid fa-rotate-right"></i>
                <h3>Rotar PDF</h3>
                <p>Gira tus documentos 90 grados a la derecha.</p>
            </div>

            <div class="card" onclick="openTool('delete')">
                <i class="card-icon fa-solid fa-trash-can"></i>
                <h3>Eliminar p√°ginas</h3>
                <p>Borra p√°ginas espec√≠ficas de tu documento.</p>
            </div>

            <div class="card" onclick="openTool('pdf2jpg')">
                <i class="card-icon fa-solid fa-image"></i>
                <h3>PDF a JPG</h3>
                <p>Convierte las p√°ginas del PDF a im√°genes.</p>
            </div>
        </div>
    </div>

    <!-- VISTA DE HERRAMIENTA (WORKSPACE) -->
    <div id="workspace" class="tool-interface">
        <h1 id="tool-title" style="margin-bottom: 10px;">Herramienta</h1>
        <p id="tool-desc" style="color:#666; margin-bottom: 30px;">Sube tus archivos para empezar</p>

        <!-- ZONA DE CARGA ARREGLADA -->
        <label class="upload-zone" id="drop-area">
            <i class="fa-solid fa-cloud-arrow-up"></i>
            <span id="drop-text">Seleccionar archivos PDF</span>
            <input type="file" id="file-upload" style="display: none;">
        </label>

        <div id="file-info" style="margin-top: 15px; color: var(--brand-color); font-weight: bold; min-height: 20px;"></div>
        
        <div id="extra-options"></div>

        <button id="action-btn" class="big-btn" disabled>Empezar</button>
        
        <div id="status" style="margin-top: 20px; font-weight: bold;"></div>

        <div class="back-link" onclick="location.reload()">
            <i class="fa-solid fa-arrow-left"></i> Volver al inicio
        </div>
    </div>

<script>
    // --- L√ìGICA JAVASCRIPT ---
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    const { PDFDocument, degrees } = PDFLib;

    const UI = {
        menu: document.getElementById('main-menu'),
        workspace: document.getElementById('workspace'),
        title: document.getElementById('tool-title'),
        desc: document.getElementById('tool-desc'),
        drop: document.getElementById('drop-area'),
        text: document.getElementById('drop-text'),
        input: document.getElementById('file-upload'),
        info: document.getElementById('file-info'),
        btn: document.getElementById('action-btn'),
        status: document.getElementById('status'),
        extras: document.getElementById('extra-options')
    };

    let activeTool = null;
    let selectedFiles = [];

    // 1. ABRIR HERRAMIENTA
    function openTool(tool) {
        activeTool = tool;
        UI.menu.style.display = 'none';
        UI.workspace.style.display = 'block';
        window.scrollTo(0,0);
        
        // Reset
        UI.status.innerText = "";
        UI.info.innerText = "";
        UI.btn.disabled = true;
        UI.extras.innerHTML = "";
        UI.input.value = "";
        selectedFiles = [];

        // Configurar Textos
        if(tool === 'merge') {
            UI.title.innerText = "Unir archivos PDF";
            UI.text.innerText = "Seleccionar varios PDF";
            UI.input.multiple = true;
            UI.btn.innerText = "Unir PDF";
        } else if(tool === 'split') {
            UI.title.innerText = "Dividir archivo PDF";
            UI.text.innerText = "Seleccionar un PDF";
            UI.input.multiple = false;
            UI.btn.innerText = "Dividir PDF";
        } else if(tool === 'excel') {
            UI.title.innerText = "Convertir PDF a EXCEL";
            UI.text.innerText = "Seleccionar un PDF";
            UI.input.multiple = false;
            UI.btn.innerText = "Convertir a Excel";
        } else if(tool === 'rotate') {
            UI.title.innerText = "Rotar PDF";
            UI.input.multiple = false;
            UI.btn.innerText = "Rotar PDF";
        } else if(tool === 'delete') {
            UI.title.innerText = "Eliminar p√°ginas";
            UI.input.multiple = false;
            UI.extras.innerHTML = '<input type="text" id="pages-in" class="input-box" placeholder="Ej: 1,3,5 (P√°ginas a borrar)">';
            UI.btn.innerText = "Eliminar p√°ginas";
        } else if(tool === 'pdf2jpg') {
            UI.title.innerText = "PDF a JPG";
            UI.input.multiple = false;
            UI.btn.innerText = "Convertir a im√°genes";
        }
    }

    // 2. MANEJO DE ARCHIVOS
    UI.drop.onclick = () => UI.input.click();
    UI.input.onchange = (e) => handleFiles(e.target.files);

    UI.drop.ondragover = (e) => { e.preventDefault(); UI.drop.style.borderColor = '#e5322d'; };
    UI.drop.ondragleave = () => UI.drop.style.borderColor = '#e0e0e0';
    UI.drop.ondrop = (e) => {
        e.preventDefault();
        UI.drop.style.borderColor = '#e0e0e0';
        handleFiles(e.dataTransfer.files);
    };

    function handleFiles(files) {
        if (!files.length) return;
        selectedFiles = Array.from(files);
        
        if (selectedFiles.length === 1) {
            UI.info.innerText = `üìÑ ${selectedFiles[0].name}`;
        } else {
            UI.info.innerText = `üìö ${selectedFiles.length} archivos seleccionados`;
        }
        UI.btn.disabled = false;
    }

    // 3. EJECUTAR ACCI√ìN
    UI.btn.onclick = async () => {
        if (!selectedFiles.length) return;
        
        UI.btn.disabled = true;
        UI.btn.innerText = "Procesando...";
        UI.status.innerHTML = "‚è≥ Trabajando...";
        UI.status.style.color = "#333";

        try {
            // L√≥gica seg√∫n herramienta
            if (activeTool === 'merge') await processMerge();
            else if (activeTool === 'split') await processSplit();
            else if (activeTool === 'excel') await processExcel();
            else if (activeTool === 'rotate') await processRotate();
            else if (activeTool === 'delete') await processDelete();
            else if (activeTool === 'pdf2jpg') await processPdfToJpg();

            UI.status.innerHTML = "‚úÖ ¬°Listo! Tu descarga ha comenzado.";
            UI.status.style.color = "green";
        } catch (error) {
            console.error(error);
            UI.status.innerHTML = `‚ùå Error: ${error.message}`;
            UI.status.style.color = "red";
        } finally {
            UI.btn.innerText = "Procesar de nuevo";
            UI.btn.disabled = false;
        }
    };

    // --- FUNCIONES INTERNAS (ENGINE) ---

    // A. UNIR
    async function processMerge() {
        if (selectedFiles.length < 2) throw new Error("Necesitas al menos 2 archivos para unir.");
        const doc = await PDFDocument.create();
        for (let file of selectedFiles) {
            const ab = await file.arrayBuffer();
            const src = await PDFDocument.load(ab);
            const pages = await doc.copyPages(src, src.getPageIndices());
            pages.forEach(p => doc.addPage(p));
        }
        const bytes = await doc.save();
        download(bytes, "unido_ipdf.pdf", "application/pdf");
    }

    // B. DIVIDIR
    async function processSplit() {
        const file = selectedFiles[0];
        const ab = await file.arrayBuffer();
        const src = await PDFDocument.load(ab);
        const zip = new JSZip();

        for(let i=0; i<src.getPageCount(); i++) {
            const newDoc = await PDFDocument.create();
            const [page] = await newDoc.copyPages(src, [i]);
            newDoc.addPage(page);
            const bytes = await newDoc.save();
            zip.file(`pagina_${i+1}.pdf`, bytes);
        }
        const content = await zip.generateAsync({type:"blob"});
        saveAs(content, "paginas_separadas.zip");
    }

    // C. EXCEL
    async function processExcel() {
        const file = selectedFiles[0];
        const ab = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(ab).promise;
        let data = [];

        for (let i=1; i<=pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const text = await page.getTextContent();
            let items = text.items.map(it => ({ str: it.str, y: it.transform[5], x: it.transform[4] }));
            items.sort((a,b) => (b.y - a.y) || (a.x - b.x));
            
            let row = [], lastY = -999;
            items.forEach(it => {
                if (lastY !== -999 && Math.abs(it.y - lastY) > 5) { data.push(row); row = []; }
                row.push(it.str);
                lastY = it.y;
            });
            if(row.length) data.push(row);
        }
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);
        XLSX.utils.book_append_sheet(wb, ws, "Datos");
        XLSX.writeFile(wb, "tabla_pdf.xlsx");
    }

    // D. ROTAR
    async function processRotate() {
        const file = selectedFiles[0];
        const ab = await file.arrayBuffer();
        const doc = await PDFDocument.load(ab);
        doc.getPages().forEach(p => p.setRotation(degrees(p.getRotation().angle + 90)));
        const bytes = await doc.save();
        download(bytes, "rotado.pdf", "application/pdf");
    }

    // E. BORRAR
    async function processDelete() {
        const input = document.getElementById('pages-in').value;
        if (!input) throw new Error("Escribe qu√© p√°ginas borrar (Ej: 1,3)");
        const toDelete = input.split(',').map(n => parseInt(n.trim()) - 1);
        
        const file = selectedFiles[0];
        const ab = await file.arrayBuffer();
        const src = await PDFDocument.load(ab);
        const newDoc = await PDFDocument.create();
        const total = src.getPageCount();

        const keep = [];
        for(let i=0; i<total; i++) if(!toDelete.includes(i)) keep.push(i);
        
        if(!keep.length) throw new Error("No puedes borrar todas las p√°ginas");

        const pages = await newDoc.copyPages(src, keep);
        pages.forEach(p => newDoc.addPage(p));
        const bytes = await newDoc.save();
        download(bytes, "paginas_restantes.pdf", "application/pdf");
    }

    // F. PDF A JPG
    async function processPdfToJpg() {
        const file = selectedFiles[0];
        const ab = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(ab).promise;
        const zip = new JSZip();

        for(let i=1; i<=pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({scale: 2.0});
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            await page.render({canvasContext: ctx, viewport: viewport}).promise;
            const blob = await new Promise(r => canvas.toBlob(r));
            zip.file(`img_${i}.jpg`, blob);
        }
        const content = await zip.generateAsync({type:"blob"});
        saveAs(content, "imagenes_pdf.zip");
    }
</script>

</body>
</html>
